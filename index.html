<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle for Virtue</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Cinzel:wght@600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #2d1b4e 100%);
            color: #fff;
            overflow: hidden;
        }
        
        /* Custom Sprite System */
        .sprite {
            position: relative;
            width: 100px;
            height: 120px;
        }
        
        .sprite-guardian {
            width: 100px;
            height: 120px;
            position: relative;
        }
        
        .sprite-guardian::before {
            content: '‚òÉÔ∏è';
            font-size: 80px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .sprite-angel {
            width: 100px;
            height: 120px;
            position: relative;
        }
        
        .sprite-angel::before {
            content: 'üòá';
            font-size: 80px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Create halo effect for angel */
        .sprite-angel::after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 15px;
            border: 3px solid #FFD700;
            border-radius: 50%;
            box-shadow: 0 0 20px #FFD700, inset 0 0 10px #FFD700;
            animation: haloGlow 2s ease-in-out infinite;
        }
        
        @keyframes haloGlow {
            0%, 100% {
                box-shadow: 0 0 20px #FFD700, inset 0 0 10px #FFD700;
                opacity: 0.8;
            }
            50% {
                box-shadow: 0 0 30px #FFD700, inset 0 0 20px #FFD700;
                opacity: 1;
            }
        }
        
        /* Enemy sprites with professional styling */
        .sprite-enemy {
            width: 100px;
            height: 100px;
            position: relative;
            font-size: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Prayer Text Display */
        #prayerTextDisplay {
            position: fixed;
            bottom: 240px;
            right: 20px;
            width: 350px;
            max-height: 400px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(26, 26, 46, 0.95));
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            display: none;
            z-index: 600;
            overflow-y: auto;
        }
        
        #prayerTextDisplay.active {
            display: block;
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .prayer-text-title {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 0 #000;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 10px;
        }
        
        .prayer-text-content {
            font-size: 14px;
            line-height: 1.8;
            color: #f0f0f0;
            text-align: justify;
            font-style: italic;
        }
        
        .close-prayer-text {
            margin-top: 15px;
            padding: 8px 20px;
            background: linear-gradient(180deg, #27ae60 0%, #1e8449 100%);
            border: 2px solid #FFD700;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 12px;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.2s;
        }
        
        .close-prayer-text:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.5);
        }
        
        /* Prayer Selection Modal */
        #prayerSelection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1600;
        }
        
        #prayerSelection.active {
            display: flex;
        }
        
        .prayer-modal {
            background: linear-gradient(135deg, rgba(15, 12, 41, 0.98), rgba(48, 43, 99, 0.98));
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.7);
        }
        
        .prayer-modal-title {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            color: #FFD700;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 3px 3px 0 #000;
        }
        
        .prayer-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .prayer-option {
            padding: 20px;
            background: linear-gradient(180deg, #9b59b6 0%, #6c3483 100%);
            border: 3px solid #FFD700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            box-shadow: 0 4px 0 #4a235a;
        }
        
        .prayer-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 #4a235a, 0 7px 20px rgba(155, 89, 182, 0.5);
        }
        
        .prayer-option:active {
            transform: translateY(1px);
            box-shadow: 0 2px 0 #4a235a;
        }
        
        .prayer-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .prayer-name {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            font-weight: 600;
        }
        
        .prayer-damage {
            font-size: 12px;
            color: #FFD700;
            margin-top: 5px;
        }
        
        /* Different Prayer Effects */
        .prayer-effect-cross {
            position: absolute;
            font-size: 60px;
            color: #FFD700;
            text-shadow: 0 0 20px #FFD700;
            animation: crossEffect 2s ease-out forwards;
            z-index: 50;
            pointer-events: none;
        }
        
        @keyframes crossEffect {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            30% {
                opacity: 1;
            }
            100% {
                transform: scale(3) rotate(720deg);
                opacity: 0;
            }
        }
        
        .prayer-effect-rose {
            position: absolute;
            font-size: 30px;
            animation: roseSpiral 2s ease-out forwards;
            z-index: 50;
            pointer-events: none;
        }
        
        @keyframes roseSpiral {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0.5);
                opacity: 0;
            }
        }
        
        .prayer-effect-glory {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff, #FFD700);
            border-radius: 50%;
            animation: gloryBurst 1.5s ease-out forwards;
            z-index: 50;
            pointer-events: none;
            box-shadow: 0 0 20px #FFD700;
        }
        
        @keyframes gloryBurst {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        .prayer-effect-jesus {
            position: absolute;
            font-size: 50px;
            animation: jesusAscend 2.5s ease-out forwards;
            z-index: 50;
            pointer-events: none;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }
        
        @keyframes jesusAscend {
            0% {
                transform: translateY(100px) scale(0.5);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) scale(1.5);
                opacity: 0;
            }
        }
        
        #introScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 40px;
        }
        
        #introScreen.hidden {
            display: none;
        }
        
        .intro-content {
            max-width: 800px;
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 50px;
            border: 4px solid #FFD700;
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
        }
        
        .intro-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(28px, 5vw, 48px);
            color: #FFD700;
            margin-bottom: 30px;
            text-shadow: 3px 3px 0 #000;
        }
        
        .intro-text {
            font-size: clamp(14px, 2.5vw, 20px);
            line-height: 1.8;
            margin-bottom: 25px;
            color: #f0f0f0;
            text-align: justify;
            font-style: italic;
        }
        
        .intro-quote {
            font-size: clamp(16px, 2.8vw, 22px);
            color: #FFD700;
            margin: 30px 0;
            font-weight: 600;
            text-shadow: 2px 2px 0 #000;
        }
        
        .start-btn {
            padding: 20px 50px;
            background: linear-gradient(180deg, #FFD700 0%, #FFA500 100%);
            border: 4px solid #fff;
            color: #000;
            font-family: 'Cinzel', serif;
            font-size: clamp(16px, 3vw, 24px);
            cursor: pointer;
            font-weight: 700;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
            box-shadow: 0 6px 0 #8B6914;
            border-radius: 10px;
            transition: all 0.2s;
            margin-top: 20px;
        }
        
        .start-btn:hover {
            background: linear-gradient(180deg, #FFEB3B 0%, #FFB300 100%);
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #8B6914;
        }
        
        .start-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #8B6914;
        }
        
        #gameContainer {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        #battleField {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 50px;
            background: 
                radial-gradient(ellipse at top, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                linear-gradient(180deg, #1a0033 0%, #0f001a 100%);
            overflow: hidden;
        }
        
        .party-side {
            display: flex;
            flex-direction: column;
            gap: 30px;
            z-index: 10;
        }
        
        .enemy-side {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .character {
            position: relative;
            text-align: center;
        }
        
        .hero-sprite {
            font-size: 80px;
            animation: heroFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }
        
        @keyframes heroFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .enemy-sprite {
            font-size: 100px;
            animation: enemyFloat 2s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(255, 0, 0, 0.6));
            margin-bottom: 20px;
        }
        
        @keyframes enemyFloat {
            0%, 100% { transform: translateY(0px) rotate(-5deg); }
            50% { transform: translateY(-12px) rotate(5deg); }
        }
        
        .character-name {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            margin-top: 15px;
            text-shadow: 2px 2px 0 #000;
            color: #FFD700;
            font-weight: 700;
        }
        
        .sin-name {
            font-size: 24px;
            color: #ff4444;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .hp-bar-container {
            width: 150px;
            height: 25px;
            background: #000;
            border: 3px solid #FFD700;
            margin: 10px auto;
            position: relative;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            border-radius: 5px;
        }
        
        .hp-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff00 0%, #ffff00 50%, #ff0000 100%);
            transition: width 0.5s ease;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        .hp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
            font-weight: bold;
            z-index: 1;
            font-family: 'Crimson Text', serif;
        }
        
        .damage-number {
            position: absolute;
            font-size: 32px;
            color: #ff0000;
            text-shadow: 3px 3px 0 #000, -1px -1px 0 #fff;
            animation: damageFloat 1.2s ease-out forwards;
            pointer-events: none;
            font-weight: bold;
            z-index: 100;
            font-family: 'Cinzel', serif;
        }
        
        @keyframes damageFloat {
            0% { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translateY(-120px) scale(1.8);
                opacity: 0;
            }
        }
        
        .heal-number {
            color: #00ff00;
        }
        
        #menuContainer {
            height: 220px;
            background: rgba(0, 0, 0, 0.95);
            border-top: 4px solid #FFD700;
            display: flex;
            position: relative;
            box-shadow: 0 -5px 30px rgba(255, 215, 0, 0.3);
        }
        
        #battleLog {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 2;
            border-right: 3px solid #FFD700;
        }
        
        .log-entry {
            margin: 8px 0;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
        }
        
        .log-damage {
            color: #ff6b6b;
            font-weight: 600;
        }
        
        .log-prayer {
            color: #51cf66;
            font-style: italic;
        }
        
        .log-system {
            color: #ffd43b;
            font-weight: 600;
        }
        
        #actionMenu {
            width: 450px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .menu-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .menu-title {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .menu-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .menu-btn {
            padding: 15px;
            background: linear-gradient(180deg, #4a90e2 0%, #2e5c8a 100%);
            border: 3px solid #FFD700;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 12px;
            cursor: pointer;
            text-shadow: 1px 1px 0 #000;
            transition: all 0.15s;
            box-shadow: 0 4px 0 #1a4d7a;
            border-radius: 5px;
            font-weight: 600;
        }
        
        .menu-btn:hover {
            background: linear-gradient(180deg, #5aa3ff 0%, #3d6fa3 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #1a4d7a;
        }
        
        .menu-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1a4d7a;
        }
        
        .menu-btn.prayer {
            background: linear-gradient(180deg, #9b59b6 0%, #6c3483 100%);
            box-shadow: 0 4px 0 #4a235a;
        }
        
        .menu-btn.prayer:hover {
            background: linear-gradient(180deg, #ae6bc7 0%, #7d3c98 100%);
        }
        
        #passageOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            padding: 40px;
        }
        
        #passageOverlay.active {
            display: flex;
        }
        
        .passage-content {
            max-width: 700px;
            background: rgba(0, 0, 0, 0.9);
            padding: 50px;
            border: 5px solid #FFD700;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.7);
            text-align: center;
        }
        
        .passage-title {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            color: #FFD700;
            margin-bottom: 25px;
            text-shadow: 3px 3px 0 #000;
        }
        
        .passage-text {
            font-size: 18px;
            line-height: 1.8;
            color: #f0f0f0;
            margin-bottom: 30px;
            text-align: justify;
            font-style: italic;
        }
        
        .passage-reference {
            font-size: 14px;
            color: #FFD700;
            font-weight: 600;
            margin-bottom: 30px;
        }
        
        .continue-btn {
            padding: 18px 45px;
            background: linear-gradient(180deg, #27ae60 0%, #1e8449 100%);
            border: 4px solid #FFD700;
            color: #fff;
            font-family: 'Cinzel', serif;
            font-size: 16px;
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 0 6px 0 #145a32;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.2s;
        }
        
        .continue-btn:hover {
            background: linear-gradient(180deg, #2ecc71 0%, #229954 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #145a32;
        }
        
        .continue-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #145a32;
        }
        
        #creditsScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 40px;
            overflow-y: auto;
        }
        
        #creditsScreen.active {
            display: flex;
        }
        
        .credits-content {
            max-width: 900px;
            text-align: center;
            padding: 50px;
        }
        
        .credits-title {
            font-family: 'Cinzel', serif;
            font-size: 48px;
            color: #FFD700;
            margin-bottom: 50px;
            text-shadow: 4px 4px 0 #000;
            animation: titleGlow 2s ease-in-out infinite;
        }
        
        @keyframes titleGlow {
            0%, 100% { text-shadow: 4px 4px 0 #000, 0 0 20px #FFD700; }
            50% { text-shadow: 4px 4px 0 #000, 0 0 40px #FFD700; }
        }
        
        .credits-section {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border: 3px solid #FFD700;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
        }
        
        .credits-subtitle {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .credits-text {
            font-size: 18px;
            line-height: 1.9;
            color: #f0f0f0;
            text-align: justify;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .character.attacking {
            animation: attackMove 0.6s ease-in-out;
        }
        
        @keyframes attackMove {
            0%, 100% { transform: translateX(0) scale(1); }
            50% { transform: translateX(50px) scale(1.2); }
        }
        
        .character.damaged {
            animation: damageShake 0.5s ease-in-out;
        }
        
        @keyframes damageShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px); }
            75% { transform: translateX(15px); }
        }
        
        .prayer-animation {
            position: absolute;
            font-size: 50px;
            animation: prayerRise 1.5s ease-out forwards;
            z-index: 50;
            pointer-events: none;
        }
        
        @keyframes prayerRise {
            0% { 
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            30% {
                opacity: 1;
            }
            100% { 
                transform: translateY(-150px) scale(1.5);
                opacity: 0;
            }
        }
        
        /* Divine Light Effect */
        .divine-light {
            position: fixed;
            top: -100%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 200%;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.9) 10%,
                rgba(255, 215, 0, 0.7) 30%,
                rgba(255, 255, 255, 0.5) 50%,
                rgba(255, 255, 255, 0) 100%);
            pointer-events: none;
            z-index: 200;
            animation: divineDescend 2s ease-out forwards;
            filter: blur(20px);
            box-shadow: 0 0 100px rgba(255, 255, 255, 0.8);
        }
        
        @keyframes divineDescend {
            0% {
                top: -100%;
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
            }
        }
        
        /* Particle Effects */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #FFD700 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 3s ease-out forwards;
            box-shadow: 0 0 10px #FFD700;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-300px) scale(0);
                opacity: 0;
            }
        }
        
        /* Enhanced Battle Background */
        #battleField::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 30% 50%, rgba(255, 215, 0, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 50%, rgba(138, 43, 226, 0.05) 0%, transparent 50%);
            animation: backgroundPulse 4s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes backgroundPulse {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }
        
        /* Glowing borders */
        .hp-bar-container {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3),
                        inset 0 0 10px rgba(255, 215, 0, 0.1);
            animation: borderGlow 2s ease-in-out infinite;
        }
        
        @keyframes borderGlow {
            0%, 100% {
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.3),
                            inset 0 0 10px rgba(255, 215, 0, 0.1);
            }
            50% {
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.6),
                            inset 0 0 15px rgba(255, 215, 0, 0.2);
            }
        }
        
        /* Enhanced hero sprites */
        .hero-sprite {
            position: relative;
        }
        
        .hero-sprite::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: heroAura 3s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes heroAura {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.5;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
        }
        
        /* Enhanced enemy sprites */
        .enemy-sprite::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 130%;
            height: 130%;
            background: radial-gradient(circle, rgba(255, 0, 0, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: enemyAura 2s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes enemyAura {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0.6;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3) rotate(180deg);
                opacity: 1;
            }
        }
        
        /* Victory sparkles */
        .victory-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            pointer-events: none;
            animation: sparkle 1.5s ease-out forwards;
            box-shadow: 0 0 10px #FFD700;
        }
        
        @keyframes sparkle {
            0% {
                transform: translate(0, 0) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(1);
                opacity: 0;
            }
        }
        
        /* Enhanced attack animation */
        .slash-effect {
            position: absolute;
            font-size: 80px;
            color: #FFD700;
            text-shadow: 0 0 20px #FFD700;
            animation: slashAnimation 0.6s ease-out forwards;
            pointer-events: none;
            z-index: 150;
        }
        
        @keyframes slashAnimation {
            0% {
                transform: translateX(-100px) rotate(-45deg) scale(0.5);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateX(100px) rotate(45deg) scale(1.5);
                opacity: 0;
            }
        }
        
        /* Audio controls */
        #audioControls {
            position: fixed;
            bottom: 230px;
            right: 20px;
            z-index: 500;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border: 2px solid #FFD700;
            border-radius: 8px;
            display: flex;
            gap: 10px;
        }
        
        .audio-btn {
            background: linear-gradient(180deg, #FFD700 0%, #FFA500 100%);
            border: 2px solid #fff;
            color: #000;
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px #FFD700;
        }
        
        @media (max-width: 768px) {
            #battleField {
                padding: 20px;
            }
            
            .hero-sprite {
                font-size: 60px;
            }
            
            .enemy-sprite {
                font-size: 70px;
            }
            
            #actionMenu {
                width: 100%;
            }
            
            .menu-btn {
                font-size: 10px;
                padding: 12px;
            }
            
            .intro-content,
            .passage-content {
                padding: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Intro Screen -->
    <div id="introScreen">
        <div class="intro-content">
            <div class="intro-title">‚õ™ BATTLE FOR VIRTUE ‚õ™</div>
            
            <div class="intro-text">
                "Man is divided in himself. As a result, the whole life of men, both individual and social, shows itself to be a struggle, and a dramatic one, between good and evil, between light and darkness."
            </div>
            
            <div class="intro-reference" style="font-size: 14px; color: #FFD700; margin-bottom: 25px;">
                ‚Äî Catechism of the Catholic Church, 409
            </div>
            
            <div class="intro-text">
                "The struggle against our inclinations toward evil is not easy; every man experiences it within himself. As a result, the entire life of man is a combat against the powers of darkness."
            </div>
            
            <div class="intro-quote">
                ‚úù IT'S UP TO YOU TO FIGHT FOR WHAT'S GOOD IN THE WORLD ‚úù
            </div>
            
            <button class="start-btn" onclick="startGame()">BEGIN YOUR JOURNEY</button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <div id="battleField">
            <div class="party-side">
                <div class="character" id="hero">
                    <div class="hero-sprite">
                        <div class="sprite sprite-guardian"></div>
                    </div>
                    <div class="character-name">GUARDIAN ANGEL</div>
                    <div class="hp-bar-container">
                        <div class="hp-bar" style="width: 100%"></div>
                        <div class="hp-text">777/777</div>
                    </div>
                </div>
                
                <div class="character" id="companion">
                    <div class="hero-sprite">
                        <div class="sprite sprite-angel"></div>
                    </div>
                    <div class="character-name">ST MICHAEL</div>
                    <div class="hp-bar-container">
                        <div class="hp-bar" style="width: 100%"></div>
                        <div class="hp-text">900/900</div>
                    </div>
                </div>
            </div>
            
            <div class="enemy-side" id="enemyContainer">
                <div class="sin-name" id="sinName">PRIDE</div>
                <div class="character enemy" id="currentEnemy">
                    <div class="enemy-sprite">
                        <div class="sprite sprite-enemy" id="enemySprite">üòà</div>
                    </div>
                    <div class="hp-bar-container">
                        <div class="hp-bar" style="width: 100%"></div>
                        <div class="hp-text">100/100</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="audioControls">
            <button class="audio-btn" id="muteBtn" onclick="toggleMute()">üîä</button>
        </div>
        
        <div id="menuContainer">
            <div id="battleLog">
                <div class="log-entry log-system">‚öîÔ∏è The battle against sin begins! ‚öîÔ∏è</div>
            </div>
            
            <div id="actionMenu">
                <div class="menu-section">
                    <div class="menu-title">‚ñ∂ ACTIONS</div>
                    <div class="menu-buttons">
                        <button class="menu-btn" onclick="selectAction('attack')">‚öîÔ∏è STRIKE</button>
                        <button class="menu-btn prayer" onclick="selectAction('prayer')">üôè PRAYER</button>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-title">CURRENT SIN: <span id="currentSinDisplay">PRIDE</span></div>
                    <div style="font-size: 12px; color: #ccc;">Defeat all Seven Deadly Sins</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prayer Selection Modal -->
    <div id="prayerSelection">
        <div class="prayer-modal">
            <div class="prayer-modal-title">‚úùÔ∏è SELECT YOUR PRAYER ‚úùÔ∏è</div>
            <div class="prayer-options" id="prayerOptions"></div>
        </div>
    </div>
    
    <!-- Prayer Text Display -->
    <div id="prayerTextDisplay">
        <div class="prayer-text-title" id="prayerTextTitle"></div>
        <div class="prayer-text-content" id="prayerTextContent"></div>
        <button class="close-prayer-text" onclick="closePrayerText()">AMEN</button>
    </div>

    <!-- Passage Overlay -->
    <div id="passageOverlay">
        <div class="passage-content">
            <div class="passage-title" id="passageTitle">Victory!</div>
            <div class="passage-text" id="passageText"></div>
            <div class="passage-reference" id="passageReference"></div>
            <button class="continue-btn" onclick="closePassage()">CONTINUE</button>
        </div>
    </div>

    <!-- Credits Screen -->
    <div id="creditsScreen">
        <div class="credits-content">
            <div class="credits-title">‚úù VICTORY OVER SIN ‚úù</div>
            
            <div class="credits-section">
                <div class="credits-subtitle">THE VIRTUES</div>
                <div class="credits-text">
                    "Human virtues are firm attitudes, stable dispositions, habitual perfections of intellect and will that govern our actions, order our passions, and guide our conduct according to reason and faith. They make possible ease, self-mastery, and joy in leading a morally good life."
                </div>
                <div class="passage-reference">‚Äî CCC 1804</div>
            </div>
            
            <div class="credits-section">
                <div class="credits-subtitle">CONSEQUENCES OF SIN</div>
                <div class="credits-text">
                    "Sin creates a proclivity to sin; it engenders vice by repetition of the same acts. This results in perverse inclinations which cloud conscience and corrupt the concrete judgment of good and evil. Thus sin tends to reproduce itself and reinforce itself, but it cannot destroy the moral sense at its root."
                </div>
                <div class="passage-reference">‚Äî CCC 1865</div>
            </div>
            
            <div class="credits-section">
                <div class="credits-subtitle">THE CALL TO HOLINESS</div>
                <div class="credits-text">
                    "All Christians in any state or walk of life are called to the fullness of Christian life and to the perfection of charity. All are called to holiness: 'Be perfect, as your heavenly Father is perfect.'"
                </div>
                <div class="passage-reference">‚Äî CCC 2013</div>
            </div>
            
            <div class="credits-section">
                <div class="credits-subtitle">GRACE AND JUSTIFICATION</div>
                <div class="credits-text">
                    "Grace is favor, the free and undeserved help that God gives us to respond to his call to become children of God, adoptive sons, partakers of the divine nature and of eternal life."
                </div>
                <div class="passage-reference">‚Äî CCC 1996</div>
            </div>
            
            <div style="margin-top: 50px;">
                <button class="continue-btn" onclick="location.reload()">PLAY AGAIN</button>
            </div>
        </div>
    </div>

    <script>
        // Audio System - Generate Piano-like Ave Maria and Christ Be Our Light
        let audioContext;
        let mainMelodyGain;
        let victoryMelodyGain;
        let isMuted = false;
        
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Main game music gain
            mainMelodyGain = audioContext.createGain();
            mainMelodyGain.connect(audioContext.destination);
            mainMelodyGain.gain.value = 0.12;
            
            // Victory music gain
            victoryMelodyGain = audioContext.createGain();
            victoryMelodyGain.connect(audioContext.destination);
            victoryMelodyGain.gain.value = 0.15;
        }
        
        function playPianoNote(frequency, startTime, duration, gainNode, velocity = 0.8) {
            // Create piano-like sound with multiple harmonics
            const fundamental = audioContext.createOscillator();
            const harmonic2 = audioContext.createOscillator();
            const harmonic3 = audioContext.createOscillator();
            
            const noteGain = audioContext.createGain();
            const harm2Gain = audioContext.createGain();
            const harm3Gain = audioContext.createGain();
            
            // Fundamental frequency
            fundamental.type = 'sine';
            fundamental.frequency.value = frequency;
            
            // Harmonics for piano-like timbre
            harmonic2.type = 'sine';
            harmonic2.frequency.value = frequency * 2;
            
            harmonic3.type = 'sine';
            harmonic3.frequency.value = frequency * 3;
            
            // Volume envelope for piano attack and decay
            const maxVol = velocity * 0.3;
            noteGain.gain.setValueAtTime(0, startTime);
            noteGain.gain.linearRampToValueAtTime(maxVol, startTime + 0.01);
            noteGain.gain.exponentialRampToValueAtTime(maxVol * 0.7, startTime + 0.1);
            noteGain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            
            harm2Gain.gain.value = 0.3;
            harm3Gain.gain.value = 0.15;
            
            fundamental.connect(noteGain);
            harmonic2.connect(harm2Gain);
            harmonic3.connect(harm3Gain);
            
            noteGain.connect(gainNode);
            harm2Gain.connect(gainNode);
            harm3Gain.connect(gainNode);
            
            fundamental.start(startTime);
            harmonic2.start(startTime);
            harmonic3.start(startTime);
            
            fundamental.stop(startTime + duration);
            harmonic2.stop(startTime + duration);
            harmonic3.stop(startTime + duration);
        }
        
        function playAveMaria() {
            if (!audioContext || isMuted) return;
            
            const now = audioContext.currentTime;
            const beat = 0.5; // Tempo
            
            // Ave Maria by Schubert - Opening melody (accurate notes)
            const melody = [
                // "A - ve Ma - ri - a"
                { note: 'G4', duration: 1.5 },
                { note: 'C5', duration: 0.5 },
                { note: 'C5', duration: 1 },
                { note: 'D5', duration: 0.5 },
                { note: 'C5', duration: 0.5 },
                { note: 'B4', duration: 1 },
                { note: 'A4', duration: 1 },
                { note: 'G4', duration: 2 },
                
                // Second phrase
                { note: 'G4', duration: 1.5 },
                { note: 'E5', duration: 0.5 },
                { note: 'E5', duration: 1 },
                { note: 'F5', duration: 0.5 },
                { note: 'E5', duration: 0.5 },
                { note: 'D5', duration: 1 },
                { note: 'C5', duration: 1 },
                { note: 'G4', duration: 2 },
                
                // Third phrase
                { note: 'C5', duration: 1.5 },
                { note: 'E5', duration: 0.5 },
                { note: 'E5', duration: 1 },
                { note: 'F5', duration: 0.5 },
                { note: 'E5', duration: 0.5 },
                { note: 'D5', duration: 1 },
                { note: 'C5', duration: 1 },
                { note: 'B4', duration: 2 },
                
                // Final phrase
                { note: 'A4', duration: 1 },
                { note: 'B4', duration: 0.5 },
                { note: 'C5', duration: 0.5 },
                { note: 'D5', duration: 1.5 },
                { note: 'C5', duration: 0.5 },
                { note: 'B4', duration: 1 },
                { note: 'A4', duration: 1 },
                { note: 'G4', duration: 3 }
            ];
            
            const noteFrequencies = {
                'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
                'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
                'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 
                'G5': 783.99, 'A5': 880.00
            };
            
            let time = now + 0.1;
            melody.forEach(({ note, duration }) => {
                playPianoNote(noteFrequencies[note], time, duration * beat, mainMelodyGain);
                time += duration * beat;
            });
            
            // Loop the melody
            setTimeout(() => playAveMaria(), (time - now) * 1000 + 1000);
        }
        
        function playChristBeOurLight() {
            if (!audioContext || isMuted) return;
            
            const now = audioContext.currentTime;
            const beat = 0.45;
            
            // "Christ Be Our Light" by Bernadette Farrell - Main melody (accurate)
            const melody = [
                // "Long-ness shad-ows for this world"
                { note: 'G4', duration: 1 },
                { note: 'G4', duration: 1 },
                { note: 'A4', duration: 0.5 },
                { note: 'B4', duration: 0.5 },
                { note: 'C5', duration: 2 },
                { note: 'B4', duration: 1 },
                { note: 'A4', duration: 1 },
                
                // "Search-ing for truth"
                { note: 'G4', duration: 1 },
                { note: 'A4', duration: 1 },
                { note: 'B4', duration: 1 },
                { note: 'C5', duration: 2 },
                { note: 'G4', duration: 2 },
                
                // "Man-y the hearts that yearn"
                { note: 'D5', duration: 1 },
                { note: 'D5', duration: 1 },
                { note: 'E5', duration: 0.5 },
                { note: 'D5', duration: 0.5 },
                { note: 'C5', duration: 2 },
                { note: 'B4', duration: 1 },
                { note: 'A4', duration: 1 },
                
                // Chorus: "Christ be our light"
                { note: 'G4', duration: 1.5 },
                { note: 'A4', duration: 0.5 },
                { note: 'B4', duration: 1 },
                { note: 'C5', duration: 1 },
                { note: 'D5', duration: 2 },
                { note: 'C5', duration: 2 },
                
                // "Shine in our hearts"
                { note: 'B4', duration: 1 },
                { note: 'C5', duration: 1 },
                { note: 'D5', duration: 1 },
                { note: 'E5', duration: 1.5 },
                { note: 'D5', duration: 0.5 },
                { note: 'C5', duration: 3 }
            ];
            
            const noteFrequencies = {
                'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
                'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
                'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 
                'G5': 783.99, 'A5': 880.00
            };
            
            let time = now + 0.1;
            melody.forEach(({ note, duration }) => {
                playPianoNote(noteFrequencies[note], time, duration * beat, victoryMelodyGain, 0.9);
                time += duration * beat;
            });
            
            // Loop the melody
            setTimeout(() => playChristBeOurLight(), (time - now) * 1000 + 1500);
        }
        
        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('muteBtn');
            btn.textContent = isMuted ? 'üîá' : 'üîä';
            
            if (isMuted) {
                mainMelodyGain.gain.value = 0;
                victoryMelodyGain.gain.value = 0;
            } else {
                mainMelodyGain.gain.value = 0.12;
                victoryMelodyGain.gain.value = 0.15;
            }
        }
        
        // Enhanced visual effects
        function createDivineLight(targetElement) {
            const light = document.createElement('div');
            light.className = 'divine-light';
            
            const rect = targetElement.getBoundingClientRect();
            light.style.left = (rect.left + rect.width / 2) + 'px';
            
            document.body.appendChild(light);
            setTimeout(() => light.remove(), 2000);
        }
        
        function createParticles(targetElement, count = 20) {
            const rect = targetElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const angle = (Math.PI * 2 * i) / count;
                const velocity = 2 + Math.random() * 2;
                const tx = Math.cos(angle) * velocity * 50;
                const ty = Math.sin(angle) * velocity * 50;
                
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                particle.style.animationDelay = (i * 0.02) + 's';
                
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 3000);
            }
        }
        
        function createVictorySparkles(targetElement, count = 50) {
            const rect = targetElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'victory-sparkle';
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * 300;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;
                    
                    sparkle.style.left = centerX + 'px';
                    sparkle.style.top = centerY + 'px';
                    sparkle.style.setProperty('--tx', tx + 'px');
                    sparkle.style.setProperty('--ty', ty + 'px');
                    
                    document.body.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1500);
                }, i * 30);
            }
        }
        
        function createSlashEffect(targetElement) {
            const rect = targetElement.getBoundingClientRect();
            const slash = document.createElement('div');
            slash.className = 'slash-effect';
            slash.textContent = '‚öîÔ∏è';
            slash.style.left = rect.left + 'px';
            slash.style.top = (rect.top + rect.height / 2) + 'px';
            
            document.body.appendChild(slash);
            setTimeout(() => slash.remove(), 600);
        }
        
        // Game state
        const game = {
            currentSinIndex: 0,
            currentTurn: 'player',
            heroes: [
                {
                    id: 'hero',
                    name: 'GUARDIAN ANGEL',
                    hp: 777,
                    maxHP: 777,
                    attack: 25
                },
                {
                    id: 'companion',
                    name: 'ST MICHAEL',
                    hp: 900,
                    maxHP: 900,
                    attack: 20
                }
            ],
            currentHeroIndex: 0,
            sins: [
                {
                    name: 'PRIDE',
                    emoji: 'üòà',
                    hp: 100,
                    maxHP: 100,
                    attack: 20,
                    passage: {
                        title: 'On Pride',
                        text: 'Pride is inordinate self-love which causes one to consider oneself superior to others and to hold others in contempt. It makes one refuse submission to God and even results in a person considering himself a god. Pride was the sin of Satan and our first parents. It is the beginning of every sin and the queen of vices.',
                        reference: 'CCC 1866, 2094'
                    }
                },
                {
                    name: 'ENVY',
                    emoji: 'üëø',
                    hp: 100,
                    maxHP: 100,
                    attack: 18,
                    passage: {
                        title: 'On Envy',
                        text: 'Envy is sadness at the sight of another\'s goods and the immoderate desire to acquire them for oneself, even unjustly. When it wishes grave harm to a neighbor it is a mortal sin. Envy represents a form of sadness and therefore a refusal of charity; the baptized person should struggle against it by exercising good will.',
                        reference: 'CCC 2539, 2540'
                    }
                },
                {
                    name: 'WRATH',
                    emoji: 'üò°',
                    hp: 110,
                    maxHP: 110,
                    attack: 25,
                    passage: {
                        title: 'On Wrath',
                        text: 'Anger is a desire for revenge. To desire vengeance in order to do evil to someone who should be punished is illicit, but it is praiseworthy to impose restitution to correct vices and maintain justice. If anger reaches the point of a deliberate desire to kill or seriously wound a neighbor, it is gravely against charity; it is a mortal sin.',
                        reference: 'CCC 2302'
                    }
                },
                {
                    name: 'SLOTH',
                    emoji: 'üò¥',
                    hp: 90,
                    maxHP: 90,
                    attack: 15,
                    passage: {
                        title: 'On Sloth',
                        text: 'Acedia or spiritual sloth goes so far as to refuse the joy that comes from God and to be repelled by divine goodness. Sloth is a culpable lack of physical or spiritual effort. It refuses to consent to the obligation of participation in the love of God and neighbor.',
                        reference: 'CCC 2094, 2733'
                    }
                },
                {
                    name: 'GREED',
                    emoji: 'üí∞',
                    hp: 100,
                    maxHP: 100,
                    attack: 22,
                    passage: {
                        title: 'On Greed',
                        text: 'Greed is a disordered desire for or inordinate attachment to material possessions and money. It is forbidden by the tenth commandment. The desire for the goods of another is immense, limitless, never satisfied. Greed is idolatry in that it makes money and possessions an ultimate end.',
                        reference: 'CCC 2536, 2551'
                    }
                },
                {
                    name: 'GLUTTONY',
                    emoji: 'üçî',
                    hp: 95,
                    maxHP: 95,
                    attack: 18,
                    passage: {
                        title: 'On Gluttony',
                        text: 'The virtue of temperance disposes us to avoid every kind of excess: the abuse of food, alcohol, tobacco, or medicine. Gluttony represents an inordinate desire to consume more than that which one requires. It is a sin against temperance and fails to respect the proper care of the body.',
                        reference: 'CCC 2290, 1809'
                    }
                },
                {
                    name: 'LUST',
                    emoji: 'üíã',
                    hp: 100,
                    maxHP: 100,
                    attack: 20,
                    passage: {
                        title: 'On Lust',
                        text: 'Lust is disordered desire for or inordinate enjoyment of sexual pleasure. Sexual pleasure is morally disordered when sought for itself, isolated from its procreative and unitive purposes. The virtue of chastity comes under the cardinal virtue of temperance, which seeks to permeate the passions and appetites of the senses with reason.',
                        reference: 'CCC 2351, 1809'
                    }
                }
            ],
            prayers: [
                { 
                    name: 'OUR FATHER', 
                    icon: '‚úùÔ∏è', 
                    damage: 40,
                    text: `Our Father, who art in heaven, hallowed be thy name; thy kingdom come; thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen.`,
                    used: false
                },
                { 
                    name: 'HAIL MARY', 
                    icon: 'üåπ', 
                    damage: 35,
                    text: `Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen.`,
                    used: false
                },
                { 
                    name: 'GLORY BE', 
                    icon: '‚ú®', 
                    damage: 30,
                    text: `Glory be to the Father, and to the Son, and to the Holy Spirit. As it was in the beginning, is now, and ever shall be, world without end. Amen.`,
                    used: false
                },
                { 
                    name: 'JESUS PRAYER', 
                    icon: 'üôè', 
                    damage: 45,
                    text: `Lord Jesus Christ, Son of God, have mercy on me, a sinner.`,
                    used: false
                }
            ],
            waitingForAction: true
        };

        function startGame() {
            document.getElementById('introScreen').classList.add('hidden');
            
            // Initialize and start audio
            initAudio();
            playAveMaria();
            
            loadCurrentSin();
        }

        function loadCurrentSin() {
            const sin = game.sins[game.currentSinIndex];
            document.getElementById('sinName').textContent = sin.name;
            document.getElementById('currentSinDisplay').textContent = sin.name;
            document.getElementById('enemySprite').textContent = sin.emoji;
            
            updateEnemyHealthBar();
            addBattleLog(`You face ${sin.name}! May God grant you strength!`, 'log-system');
        }

        function selectAction(action) {
            if (!game.waitingForAction) return;
            
            game.waitingForAction = false;
            const currentHero = game.heroes[game.currentHeroIndex];
            
            if (action === 'attack') {
                executeAttack(currentHero);
            } else if (action === 'prayer') {
                showPrayerMenu();
            }
        }

        function showPrayerMenu() {
            game.waitingForAction = true;
            
            const modal = document.getElementById('prayerSelection');
            const optionsContainer = document.getElementById('prayerOptions');
            optionsContainer.innerHTML = '';
            
            game.prayers.forEach((prayer, index) => {
                const option = document.createElement('div');
                option.className = 'prayer-option';
                option.innerHTML = `
                    <div class="prayer-icon">${prayer.icon}</div>
                    <div class="prayer-name">${prayer.name}</div>
                    <div class="prayer-damage">Holy Damage: ${prayer.damage}</div>
                `;
                option.onclick = () => selectPrayer(index);
                optionsContainer.appendChild(option);
            });
            
            modal.classList.add('active');
        }
        
        function selectPrayer(prayerIndex) {
            const prayer = game.prayers[prayerIndex];
            document.getElementById('prayerSelection').classList.remove('active');
            game.waitingForAction = false;
            
            // Show prayer text if first time using
            if (!prayer.used) {
                showPrayerText(prayer);
                prayer.used = true;
            }
            
            executePrayer(game.heroes[game.currentHeroIndex], prayer);
        }
        
        function showPrayerText(prayer) {
            document.getElementById('prayerTextTitle').textContent = prayer.name;
            document.getElementById('prayerTextContent').textContent = prayer.text;
            document.getElementById('prayerTextDisplay').classList.add('active');
        }
        
        function closePrayerText() {
            document.getElementById('prayerTextDisplay').classList.remove('active');
        }

        function executeAttack(hero) {
            const sin = game.sins[game.currentSinIndex];
            const damage = Math.floor(hero.attack + Math.random() * 10);
            
            const heroEl = document.getElementById(hero.id);
            heroEl.classList.add('attacking');
            
            setTimeout(() => {
                heroEl.classList.remove('attacking');
                
                // Add slash effect
                const enemyEl = document.getElementById('currentEnemy');
                createSlashEffect(enemyEl);
                createParticles(enemyEl, 15);
                
                applyDamageToEnemy(damage);
                addBattleLog(`${hero.name} strikes ${sin.name} for ${damage} damage!`, 'log-damage');
                
                checkBattleEnd();
            }, 300);
        }

        function executePrayer(hero, prayer) {
            const sin = game.sins[game.currentSinIndex];
            
            const heroEl = document.getElementById(hero.id);
            const enemyEl = document.getElementById('currentEnemy');
            
            heroEl.classList.add('attacking');
            
            // Create divine light from heaven
            createDivineLight(enemyEl);
            
            // Create different effects based on prayer type
            const rect = enemyEl.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            if (prayer.name === 'OUR FATHER') {
                // Cross effect
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const cross = document.createElement('div');
                        cross.className = 'prayer-effect-cross';
                        cross.textContent = '‚úùÔ∏è';
                        cross.style.left = centerX + 'px';
                        cross.style.top = centerY + 'px';
                        document.body.appendChild(cross);
                        setTimeout(() => cross.remove(), 2000);
                    }, i * 200);
                }
            } else if (prayer.name === 'HAIL MARY') {
                // Rose spiral effect
                for (let i = 0; i < 12; i++) {
                    setTimeout(() => {
                        const rose = document.createElement('div');
                        rose.className = 'prayer-effect-rose';
                        rose.textContent = 'üåπ';
                        const angle = (i / 12) * Math.PI * 2;
                        const distance = 150;
                        rose.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                        rose.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                        rose.style.left = centerX + 'px';
                        rose.style.top = centerY + 'px';
                        document.body.appendChild(rose);
                        setTimeout(() => rose.remove(), 2000);
                    }, i * 50);
                }
            } else if (prayer.name === 'GLORY BE') {
                // Glory burst - star particles
                for (let i = 0; i < 40; i++) {
                    setTimeout(() => {
                        const glory = document.createElement('div');
                        glory.className = 'prayer-effect-glory';
                        const angle = Math.random() * Math.PI * 2;
                        const distance = 100 + Math.random() * 150;
                        glory.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                        glory.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                        glory.style.left = centerX + 'px';
                        glory.style.top = centerY + 'px';
                        document.body.appendChild(glory);
                        setTimeout(() => glory.remove(), 1500);
                    }, i * 20);
                }
            } else if (prayer.name === 'JESUS PRAYER') {
                // Jesus prayer - ascending text
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const jesus = document.createElement('div');
                        jesus.className = 'prayer-effect-jesus';
                        jesus.textContent = 'üôè';
                        jesus.style.left = (centerX - 40 + i * 20) + 'px';
                        jesus.style.top = (centerY + 50) + 'px';
                        document.body.appendChild(jesus);
                        setTimeout(() => jesus.remove(), 2500);
                    }, i * 150);
                }
            }
            
            // Create prayer animation
            const heroRect = heroEl.getBoundingClientRect();
            const prayerAnim = document.createElement('div');
            prayerAnim.className = 'prayer-animation';
            prayerAnim.textContent = prayer.icon;
            prayerAnim.style.left = heroRect.left + heroRect.width / 2 + 'px';
            prayerAnim.style.top = heroRect.top + 'px';
            document.body.appendChild(prayerAnim);
            
            setTimeout(() => prayerAnim.remove(), 1500);
            
            // Create particles around hero
            createParticles(heroEl, 25);
            
            setTimeout(() => {
                heroEl.classList.remove('attacking');
                
                // More particles on enemy when hit by holy light
                createParticles(enemyEl, 30);
                
                applyDamageToEnemy(prayer.damage);
                addBattleLog(`${hero.name} prays ${prayer.name}! ${sin.name} takes ${prayer.damage} holy damage!`, 'log-prayer');
                
                checkBattleEnd();
            }, 800);
        }

        function applyDamageToEnemy(damage) {
            const sin = game.sins[game.currentSinIndex];
            sin.hp = Math.max(0, sin.hp - damage);
            
            const enemyEl = document.getElementById('currentEnemy');
            enemyEl.classList.add('damaged');
            setTimeout(() => enemyEl.classList.remove('damaged'), 500);
            
            updateEnemyHealthBar();
            showDamageNumber('currentEnemy', damage, false);
        }

        function updateEnemyHealthBar() {
            const sin = game.sins[game.currentSinIndex];
            const enemyEl = document.getElementById('currentEnemy');
            const hpBar = enemyEl.querySelector('.hp-bar');
            const hpText = enemyEl.querySelector('.hp-text');
            
            const percent = (sin.hp / sin.maxHP) * 100;
            hpBar.style.width = percent + '%';
            hpText.textContent = `${Math.floor(sin.hp)}/${sin.maxHP}`;
        }

        function updateHeroHealthBar(heroId) {
            const hero = game.heroes.find(h => h.id === heroId);
            const heroEl = document.getElementById(heroId);
            const hpBar = heroEl.querySelector('.hp-bar');
            const hpText = heroEl.querySelector('.hp-text');
            
            const percent = (hero.hp / hero.maxHP) * 100;
            hpBar.style.width = percent + '%';
            hpText.textContent = `${Math.floor(hero.hp)}/${hero.maxHP}`;
        }

        function showDamageNumber(targetId, amount, isHeal) {
            const targetEl = document.getElementById(targetId);
            const rect = targetEl.getBoundingClientRect();
            
            const damageNum = document.createElement('div');
            damageNum.className = 'damage-number' + (isHeal ? ' heal-number' : '');
            damageNum.textContent = (isHeal ? '+' : '-') + amount;
            damageNum.style.left = rect.left + rect.width / 2 + 'px';
            damageNum.style.top = rect.top + 'px';
            
            document.body.appendChild(damageNum);
            setTimeout(() => damageNum.remove(), 1200);
        }

        function checkBattleEnd() {
            const sin = game.sins[game.currentSinIndex];
            
            if (sin.hp <= 0) {
                const enemyEl = document.getElementById('currentEnemy');
                createVictorySparkles(enemyEl, 60);
                
                addBattleLog(`${sin.name} has been vanquished!`, 'log-system');
                showPassage(sin.passage);
                return;
            }
            
            setTimeout(() => enemyTurn(), 1000);
        }

        function enemyTurn() {
            const sin = game.sins[game.currentSinIndex];
            const target = game.heroes[Math.floor(Math.random() * game.heroes.length)];
            
            const damage = Math.floor(sin.attack + Math.random() * 8);
            
            target.hp = Math.max(0, target.hp - damage);
            
            const targetEl = document.getElementById(target.id);
            targetEl.classList.add('damaged');
            setTimeout(() => targetEl.classList.remove('damaged'), 500);
            
            updateHeroHealthBar(target.id);
            showDamageNumber(target.id, damage, false);
            addBattleLog(`${sin.name} attacks ${target.name} for ${damage} damage!`, 'log-damage');
            
            if (game.heroes.every(h => h.hp <= 0)) {
                setTimeout(() => {
                    alert('You have been defeated. But do not lose hope - try again!');
                    location.reload();
                }, 1000);
                return;
            }
            
            game.currentHeroIndex = (game.currentHeroIndex + 1) % game.heroes.length;
            game.waitingForAction = true;
        }

        function showPassage(passage) {
            document.getElementById('passageTitle').textContent = passage.title;
            document.getElementById('passageText').textContent = passage.text;
            document.getElementById('passageReference').textContent = passage.reference;
            document.getElementById('passageOverlay').classList.add('active');
        }

        function closePassage() {
            document.getElementById('passageOverlay').classList.remove('active');
            
            game.currentSinIndex++;
            
            if (game.currentSinIndex >= game.sins.length) {
                showCredits();
            } else {
                loadCurrentSin();
                game.waitingForAction = true;
            }
        }

        function showCredits() {
            // Stop main music and start victory music
            mainMelodyGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            setTimeout(() => {
                playChristBeOurLight();
            }, 1000);
            
            document.getElementById('creditsScreen').classList.add('active');
        }

        function addBattleLog(message, className = '') {
            const log = document.getElementById('battleLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + className;
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
    </script>
</body>
</html>
